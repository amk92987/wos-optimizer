"""
Build Buildings FC (Fire Crystal) edges from raw data.
Generates upgrade edges for FC levels (30-1 through FC10-0) for key buildings.
"""

import json
from pathlib import Path
from datetime import datetime, timezone
import re

# Paths
PROJECT_ROOT = Path(__file__).parent.parent
EDGES_FILE = PROJECT_ROOT / "data" / "upgrades" / "buildings.fc.edges.json"
REPORT_FILE = PROJECT_ROOT / "data" / "validation" / "buildings.fc.report.json"


def parse_time(time_str: str) -> int:
    """Convert time string like '1d 4h 30m' or '7d' to seconds."""
    if not time_str or time_str == "N/A" or time_str == "—":
        return 0

    total_seconds = 0
    time_str = time_str.strip()

    # Handle days
    if 'd' in time_str:
        match = re.match(r'(\d+)d', time_str)
        if match:
            total_seconds += int(match.group(1)) * 86400
        time_str = re.sub(r'\d+d\s*', '', time_str)

    # Handle hours (h or :)
    if 'h' in time_str:
        match = re.search(r'(\d+)h', time_str)
        if match:
            total_seconds += int(match.group(1)) * 3600
        time_str = re.sub(r'\d+h\s*', '', time_str)
    elif ':' in time_str:
        parts = time_str.split(':')
        if len(parts) >= 2:
            total_seconds += int(parts[0]) * 3600  # hours
            total_seconds += int(parts[1]) * 60   # minutes
            if len(parts) == 3:
                total_seconds += int(parts[2])    # seconds
        return total_seconds

    # Handle minutes
    if 'm' in time_str:
        match = re.search(r'(\d+)m', time_str)
        if match:
            total_seconds += int(match.group(1)) * 60
        time_str = re.sub(r'\d+m\s*', '', time_str)

    # Handle seconds
    if 's' in time_str:
        match = re.search(r'(\d+)s', time_str)
        if match:
            total_seconds += int(match.group(1))

    return total_seconds


def parse_cost(cost_str: str) -> int:
    """Parse cost string like '13M' or '3.3M' or '840K' to integer."""
    if not cost_str or cost_str == "—" or cost_str == "0":
        return 0

    cost_str = str(cost_str).strip().upper()

    # Handle M (millions)
    if 'M' in cost_str:
        num = float(cost_str.replace('M', ''))
        return int(num * 1_000_000)

    # Handle K (thousands)
    if 'K' in cost_str:
        num = float(cost_str.replace('K', ''))
        return int(num * 1_000)

    # Plain number
    try:
        return int(float(cost_str))
    except:
        return 0


# FC Building Data - extracted from whiteoutsurvival.app
# Format: [level, wood, meat, coal, iron, fire_crystal, refined_fc, time_str, power, furnace_prereq]

FC_BUILDINGS_DATA = {
    "furnace": {
        "levels": [
            ["30-1", "67M", "67M", "13M", "3.3M", 132, 0, "7d", 1580900, None],
            ["FC1-0", "67M", "67M", "13M", "3.3M", 132, 0, "7d", 1810500, None],
            ["FC1-1", "72M", "72M", "14M", "3.6M", 158, 0, "9d", 1867900, None],
            ["FC2-0", "72M", "72M", "14M", "3.6M", 158, 0, "9d", 2097500, None],
            ["FC2-1", "79M", "79M", "15M", "3.9M", 238, 0, "11d", 2154900, None],
            ["FC3-0", "79M", "79M", "15M", "3.9M", 238, 0, "11d", 2384500, None],
            ["FC3-1", "82M", "82M", "16M", "4.1M", 280, 0, "12d", 2447700, None],
            ["FC4-0", "82M", "82M", "16M", "4.1M", 280, 0, "12d", 2700500, None],
            ["FC4-1", "84M", "84M", "16M", "4.2M", 335, 0, "14d", 2763700, None],
            ["FC5-0", "84M", "84M", "16M", "4.2M", 335, 0, "14d", 3016500, None],
            ["FC5-1", "96M", "96M", "19M", "4.8M", 200, 10, "15d", 3084100, None],
            ["FC6-0", "96M", "96M", "19M", "4.8M", 100, 20, "15d", 3354500, None],
            ["FC6-1", "100M", "100M", "21M", "5.4M", 240, 15, "18d", 3422100, None],
            ["FC7-0", "100M", "100M", "21M", "5.4M", 120, 30, "18d", 3692500, None],
            ["FC7-1", "130M", "130M", "26M", "6.6M", 240, 20, "20d", 3760100, None],
            ["FC8-0", "130M", "130M", "26M", "6.6M", 120, 40, "20d", 4030500, None],
            ["FC8-1", "140M", "140M", "29M", "7.2M", 280, 30, "13d", 4102900, None],
            ["FC9-0", "140M", "140M", "29M", "7.2M", 140, 60, "13d", 4392500, None],
            ["FC9-1", "160M", "160M", "33M", "8.4M", 350, 70, "20d", 4464900, None],
            ["FC10-0", "160M", "160M", "33M", "8.4M", 175, 140, "20d", 4754500, None],
        ]
    },
    "embassy": {
        "levels": [
            ["30-1", "13M", "13M", "2.7M", "679K", 33, 0, "4d 14h 52m", 347798, "FC1"],
            ["30-2", "13M", "13M", "2.7M", "670K", 33, 0, "4d 14h 52m", 360426, "FC1"],
            ["30-3", "13M", "13M", "2.7M", "670K", 33, 0, "4d 14h 52m", 373054, "FC1"],
            ["30-4", "13M", "13M", "2.7M", "670K", 33, 0, "4d 14h 52m", 385682, "FC1"],
            ["FC1-0", "13M", "13M", "2.7M", "670K", 33, 0, "4d 14h 52m", 398310, "FC1"],
            ["FC1-1", "14M", "14M", "2.9M", "720K", 39, 0, "5d 22h 33m", 410938, "FC2"],
            ["FC1-2", "14M", "14M", "2.9M", "720K", 39, 0, "5d 22h 33m", 423566, "FC2"],
            ["FC1-3", "14M", "14M", "2.9M", "720K", 39, 0, "5d 22h 33m", 436194, "FC2"],
            ["FC1-4", "14M", "14M", "2.9M", "720K", 39, 0, "5d 22h 33m", 448822, "FC2"],
            ["FC2-0", "14M", "14M", "2.9M", "1M", 39, 0, "5d 22h 33m", 461450, "FC2"],
            ["FC2-1", "15M", "15M", "3.1M", "790K", 59, 0, "7d 6h 14m", 474087, "FC3"],
            ["FC2-2", "15M", "15M", "3.1M", "790K", 59, 0, "7d 6h 14m", 486706, "FC3"],
            ["FC2-3", "15M", "15M", "3.1M", "790K", 59, 0, "7d 6h 14m", 499334, "FC3"],
            ["FC2-4", "15M", "15M", "3.1M", "790K", 59, 0, "7d 6h 14m", 511962, "FC3"],
            ["FC3-0", "15M", "15M", "3.1M", "790K", 59, 0, "7d 6h 14m", 524590, "FC3"],
            ["FC3-1", "16M", "16M", "3.2M", "820K", 70, 0, "7d 22h 4m", 538494, "FC4"],
            ["FC3-2", "16M", "16M", "3.2M", "820K", 70, 0, "7d 22h 4m", 552398, "FC4"],
            ["FC3-3", "16M", "16M", "3.2M", "820K", 70, 0, "7d 22h 4m", 566302, "FC4"],
            ["FC3-4", "16M", "16M", "3.2M", "820K", 70, 0, "7d 22h 4m", 580206, "FC4"],
            ["FC4-0", "16M", "16M", "3.2M", "820K", 70, 0, "7d 22h 4m", 594110, "FC4"],
            ["FC4-1", "16M", "16M", "3.3M", "840K", 83, 0, "9d 5h 45m", 608014, "FC5"],
            ["FC4-2", "16M", "16M", "3.3M", "840K", 83, 0, "9d 5h 45m", 621918, "FC5"],
            ["FC4-3", "16M", "16M", "3.3M", "840K", 83, 0, "9d 5h 45m", 635822, "FC5"],
            ["FC4-4", "16M", "16M", "3.3M", "840K", 83, 0, "9d 5h 45m", 649726, "FC5"],
            ["FC5-0", "16M", "16M", "3.3M", "840K", 83, 0, "9d 5h 45m", 663630, "FC5"],
            ["FC5-1", "19M", "19M", "3.8M", "960K", 50, 2, "9d 21h 36m", 678502, "FC6"],
            ["FC5-2", "19M", "19M", "3.8M", "960K", 50, 2, "9d 21h 36m", 693374, "FC6"],
            ["FC5-3", "19M", "19M", "3.8M", "960K", 50, 2, "9d 21h 36m", 708246, "FC6"],
            ["FC5-4", "19M", "19M", "3.8M", "960K", 50, 2, "9d 21h 36m", 723118, "FC6"],
            ["FC6-0", "19M", "19M", "3.8M", "960K", 25, 5, "9d 21h 36m", 737990, "FC6"],
            ["FC6-1", "21M", "21M", "4.3M", "1M", 60, 3, "11d 21h 7m", 752862, "FC7"],
            ["FC6-2", "21M", "21M", "4.3M", "1M", 60, 3, "11d 21h 7m", 767734, "FC7"],
            ["FC6-3", "21M", "21M", "4.3M", "1M", 60, 3, "11d 21h 7m", 782606, "FC7"],
            ["FC6-4", "21M", "21M", "4.3M", "1M", 60, 3, "11d 21h 7m", 797478, "FC7"],
            ["FC7-0", "21M", "21M", "4.3M", "1M", 30, 7, "11d 21h 7m", 812350, "FC7"],
            ["FC7-1", "26M", "26M", "5.3M", "1.3M", 60, 5, "13d 4h 48m", 827222, "FC8"],
            ["FC7-2", "26M", "26M", "5.3M", "1.3M", 60, 5, "13d 4h 48m", 842094, "FC8"],
            ["FC7-3", "26M", "26M", "5.3M", "1.3M", 60, 5, "13d 4h 48m", 856966, "FC8"],
            ["FC7-4", "26M", "26M", "5.3M", "1.3M", 60, 5, "13d 4h 48m", 871838, "FC8"],
            ["FC8-0", "26M", "26M", "5.3M", "1.3M", 30, 10, "13d 4h 48m", 886710, "FC8"],
            ["FC8-1", "29M", "29M", "5.8M", "1.4M", 70, 7, "8d 13h 55m", 902638, "FC9"],
            ["FC8-2", "29M", "29M", "5.8M", "1.4M", 70, 7, "8d 13h 55m", 918566, "FC9"],
            ["FC8-3", "29M", "29M", "5.8M", "1.4M", 70, 7, "8d 13h 55m", 934494, "FC9"],
            ["FC8-4", "29M", "29M", "5.8M", "1.4M", 70, 7, "8d 13h 55m", 950422, "FC9"],
            ["FC9-0", "29M", "29M", "5.8M", "1.4M", 35, 15, "8d 13h 55m", 966350, "FC9"],
            ["FC9-1", "33M", "33M", "6.7M", "1.6M", 87, 17, "13d 4h 48m", 982278, "FC10"],
            ["FC9-2", "33M", "33M", "6.7M", "1.6M", 87, 17, "13d 4h 48m", 998206, "FC10"],
            ["FC9-3", "33M", "33M", "6.7M", "1.6M", 87, 17, "13d 4h 48m", 1014134, "FC10"],
            ["FC9-4", "33M", "33M", "6.7M", "1.6M", 87, 17, "13d 4h 48m", 1030062, "FC10"],
            ["FC10-0", "33M", "33M", "6.7M", "1.6M", 43, 35, "13d 4h 48m", 1045990, "FC10"],
        ]
    },
    "command_center": {
        "levels": [
            ["30-1", "20M", "20M", "4M", "1M", 26, 0, "20h 9m 30s", 221326, "FC1"],
            ["30-2", "20M", "20M", "4M", "1M", 26, 0, "20h 9m 30s", 229362, "FC1"],
            ["30-3", "20M", "20M", "4M", "1M", 26, 0, "20h 9m 30s", 237398, "FC1"],
            ["30-4", "20M", "20M", "4M", "1M", 26, 0, "20h 9m 30s", 245434, "FC1"],
            ["FC1-0", "20M", "20M", "4M", "1M", 26, 0, "20h 9m 30s", 253470, "FC1"],
            ["FC1-1", "21M", "21M", "4.3M", "1M", 31, 0, "1d 1h 55m", 261506, "FC2"],
            ["FC1-2", "21M", "21M", "4.3M", "1M", 31, 0, "1d 1h 55m", 269542, "FC2"],
            ["FC1-3", "21M", "21M", "4.3M", "1M", 31, 0, "1d 1h 55m", 277578, "FC2"],
            ["FC1-4", "21M", "21M", "4.3M", "1M", 31, 0, "1d 1h 55m", 285614, "FC2"],
            ["FC2-0", "21M", "21M", "4.3M", "1M", 31, 0, "1d 1h 55m", 293650, "FC2"],
            ["FC2-1", "23M", "23M", "4.7M", "1.1M", 47, 0, "1d 7h 40m", 301686, "FC3"],
            ["FC2-2", "23M", "23M", "4.7M", "1.1M", 47, 0, "1d 7h 40m", 309722, "FC3"],
            ["FC2-3", "23M", "23M", "4.7M", "1.1M", 47, 0, "1d 7h 40m", 317758, "FC3"],
            ["FC2-4", "23M", "23M", "4.7M", "1.1M", 47, 0, "1d 7h 40m", 325794, "FC3"],
            ["FC3-0", "23M", "23M", "4.7M", "1.1M", 47, 0, "1d 7h 40m", 333830, "FC3"],
            ["FC3-1", "24M", "24M", "4.9M", "1.2M", 56, 0, "1d 10h 33m", 342678, "FC4"],
            ["FC3-2", "24M", "24M", "4.9M", "1.2M", 56, 0, "1d 10h 33m", 351526, "FC4"],
            ["FC3-3", "24M", "24M", "4.9M", "1.2M", 56, 0, "1d 10h 33m", 360374, "FC4"],
            ["FC3-4", "24M", "24M", "4.9M", "1.2M", 56, 0, "1d 10h 33m", 369222, "FC4"],
            ["FC4-0", "24M", "24M", "4.9M", "1.2M", 56, 0, "1d 10h 33m", 378070, "FC4"],
            ["FC4-1", "25M", "25M", "5M", "1.2M", 67, 0, "1d 16h 31m", 386918, "FC5"],
            ["FC4-2", "25M", "25M", "5M", "1.2M", 67, 0, "1d 16h 31m", 395766, "FC5"],
            ["FC4-3", "25M", "25M", "5M", "1.2M", 67, 0, "1d 16h 31m", 404614, "FC5"],
            ["FC4-4", "25M", "25M", "5M", "1.2M", 67, 0, "1d 16h 31m", 413462, "FC5"],
            ["FC5-0", "25M", "25M", "5M", "1.2M", 67, 0, "1d 16h 31m", 422310, "FC5"],
            ["FC5-1", "29M", "29M", "5.8M", "1.4M", 40, 2, "1d 19h 12m", 431774, "FC6"],
            ["FC5-2", "29M", "29M", "5.8M", "1.4M", 40, 2, "1d 19h 12m", 441238, "FC6"],
            ["FC5-3", "29M", "29M", "5.8M", "1.4M", 40, 2, "1d 19h 12m", 450702, "FC6"],
            ["FC5-4", "29M", "29M", "5.8M", "1.4M", 40, 2, "1d 19h 12m", 460166, "FC6"],
            ["FC6-0", "29M", "29M", "5.8M", "1.4M", 20, 4, "1d 19h 12m", 469630, "FC6"],
            ["FC6-1", "32M", "32M", "6.5M", "1.5M", 48, 3, "2d 1h 30m", 479094, "FC7"],
            ["FC6-2", "32M", "32M", "6.5M", "1.5M", 48, 3, "2d 1h 30m", 488558, "FC7"],
            ["FC6-3", "32M", "32M", "6.5M", "1.5M", 48, 3, "2d 1h 30m", 498022, "FC7"],
            ["FC6-4", "32M", "32M", "6.5M", "1.5M", 48, 3, "2d 1h 30m", 507486, "FC7"],
            ["FC7-0", "32M", "32M", "6.5M", "1.5M", 24, 6, "2d 1h 30m", 516950, "FC7"],
            ["FC7-1", "39M", "39M", "7.9M", "1.9M", 48, 4, "2d 9h 36m", 526414, "FC8"],
            ["FC7-2", "39M", "39M", "7.9M", "1.9M", 48, 4, "2d 9h 36m", 535878, "FC8"],
            ["FC7-3", "39M", "39M", "7.9M", "1.9M", 48, 4, "2d 9h 36m", 545342, "FC8"],
            ["FC7-4", "39M", "39M", "7.9M", "1.9M", 48, 4, "2d 9h 36m", 554806, "FC8"],
            ["FC8-0", "39M", "39M", "7.9M", "1.9M", 24, 8, "2d 9h 36m", 564270, "FC8"],
            ["FC8-1", "43M", "43M", "8.7M", "2.1M", 56, 6, "1d 13h 26m", 574406, "FC9"],
            ["FC8-2", "43M", "43M", "8.7M", "2.1M", 56, 6, "1d 13h 26m", 584542, "FC9"],
            ["FC8-3", "43M", "43M", "8.7M", "2.1M", 56, 6, "1d 13h 26m", 594678, "FC9"],
            ["FC8-4", "43M", "43M", "8.7M", "2.1M", 56, 6, "1d 13h 26m", 604814, "FC9"],
            ["FC9-0", "43M", "43M", "8.7M", "2.1M", 28, 12, "1d 13h 26m", 614950, "FC9"],
            ["FC9-1", "50M", "50M", "10M", "2.5M", 70, 14, "2d 9h 36m", 625086, "FC10"],
            ["FC9-2", "50M", "50M", "10M", "2.5M", 70, 14, "2d 9h 36m", 635222, "FC10"],
            ["FC9-3", "50M", "50M", "10M", "2.5M", 70, 14, "2d 9h 36m", 645358, "FC10"],
            ["FC9-4", "50M", "50M", "10M", "2.5M", 70, 14, "2d 9h 36m", 655494, "FC10"],
            ["FC10-0", "50M", "50M", "10M", "2.5M", 35, 28, "2d 9h 36m", 665630, "FC10"],
        ]
    },
    "infirmary": {
        "levels": [
            ["30-1", "16M", "16M", "3.3M", "840K", 26, 0, "23h 31m", 237135, "FC1"],
            ["30-2", "16M", "16M", "3.3M", "840K", 26, 0, "23h 31m", 245745, "FC1"],
            ["30-3", "16M", "16M", "3.3M", "840K", 26, 0, "23h 31m", 254355, "FC1"],
            ["30-4", "16M", "16M", "3.3M", "840K", 26, 0, "23h 31m", 262965, "FC1"],
            ["FC1-0", "16M", "16M", "3.3M", "840K", 26, 0, "23h 31m", 271575, "FC1"],
            ["FC1-1", "18M", "18M", "3.6M", "900K", 31, 0, "1d 6h 14m", 280185, "FC2"],
            ["FC1-2", "18M", "18M", "3.6M", "900K", 31, 0, "1d 6h 14m", 288795, "FC2"],
            ["FC1-3", "18M", "18M", "3.6M", "900K", 31, 0, "1d 6h 14m", 297405, "FC2"],
            ["FC1-4", "18M", "18M", "3.6M", "900K", 31, 0, "1d 6h 14m", 306015, "FC2"],
            ["FC2-0", "18M", "18M", "3.6M", "900K", 31, 0, "1d 6h 14m", 314625, "FC2"],
            ["FC2-1", "19M", "19M", "3.9M", "990K", 47, 0, "1d 12h 57m", 323235, "FC3"],
            ["FC2-2", "19M", "19M", "3.9M", "990K", 47, 0, "1d 12h 57m", 331845, "FC3"],
            ["FC2-3", "19M", "19M", "3.9M", "990K", 47, 0, "1d 12h 57m", 340455, "FC3"],
            ["FC2-4", "19M", "19M", "3.9M", "990K", 47, 0, "1d 12h 57m", 349065, "FC3"],
            ["FC3-0", "19M", "19M", "3.9M", "990K", 47, 0, "1d 12h 57m", 357675, "FC3"],
            ["FC3-1", "20M", "20M", "4.1M", "1M", 56, 0, "1d 16h 19m", 367155, "FC4"],
            ["FC3-2", "20M", "20M", "4.1M", "1M", 56, 0, "1d 16h 19m", 376635, "FC4"],
            ["FC3-3", "20M", "20M", "4.1M", "1M", 56, 0, "1d 16h 19m", 386115, "FC4"],
            ["FC3-4", "20M", "20M", "4.1M", "1M", 56, 0, "1d 16h 19m", 395595, "FC4"],
            ["FC4-0", "20M", "20M", "4.1M", "1M", 56, 0, "1d 16h 19m", 405075, "FC4"],
            ["FC4-1", "21M", "21M", "4.2M", "1M", 67, 0, "1d 23h 2m", 414555, "FC5"],
            ["FC4-2", "21M", "21M", "4.2M", "1M", 67, 0, "1d 23h 2m", 424035, "FC5"],
            ["FC4-3", "21M", "21M", "4.2M", "1M", 67, 0, "1d 23h 2m", 433515, "FC5"],
            ["FC4-4", "21M", "21M", "4.2M", "1M", 67, 0, "1d 23h 2m", 442995, "FC5"],
            ["FC5-0", "21M", "21M", "4.2M", "1M", 67, 0, "1d 23h 2m", 452475, "FC5"],
            ["FC5-1", "24M", "24M", "4.8M", "1.2M", 40, 2, "2d 2h 24m", 462615, "FC6"],
            ["FC5-2", "24M", "24M", "4.8M", "1.2M", 40, 2, "2d 2h 24m", 472755, "FC6"],
            ["FC5-3", "24M", "24M", "4.8M", "1.2M", 40, 2, "2d 2h 24m", 482895, "FC6"],
            ["FC5-4", "24M", "24M", "4.8M", "1.2M", 40, 2, "2d 2h 24m", 493035, "FC6"],
            ["FC6-0", "24M", "24M", "4.8M", "1.2M", 20, 4, "2d 2h 24m", 503175, "FC6"],
            ["FC6-1", "27M", "27M", "5.4M", "1.3M", 48, 3, "2d 12h 28m", 513315, "FC7"],
            ["FC6-2", "27M", "27M", "5.4M", "1.3M", 48, 3, "2d 12h 28m", 523455, "FC7"],
            ["FC6-3", "27M", "27M", "5.4M", "1.3M", 48, 3, "2d 12h 28m", 533595, "FC7"],
            ["FC6-4", "27M", "27M", "5.4M", "1.3M", 48, 3, "2d 12h 28m", 543735, "FC7"],
            ["FC7-0", "27M", "27M", "5.4M", "1.3M", 24, 6, "2d 12h 28m", 553875, "FC7"],
            ["FC7-1", "33M", "33M", "6.6M", "1.6M", 48, 4, "2d 19h 12m", 564015, "FC8"],
            ["FC7-2", "33M", "33M", "6.6M", "1.6M", 48, 4, "2d 19h 12m", 574155, "FC8"],
            ["FC7-3", "33M", "33M", "6.6M", "1.6M", 48, 4, "2d 19h 12m", 584295, "FC8"],
            ["FC7-4", "33M", "33M", "6.6M", "1.6M", 48, 4, "2d 19h 12m", 594435, "FC8"],
            ["FC8-0", "33M", "33M", "6.6M", "1.6M", 24, 8, "2d 19h 12m", 604575, "FC8"],
            ["FC8-1", "36M", "36M", "7.2M", "1.8M", 56, 6, "1d 19h 12m", 614715, "FC9"],
            ["FC8-2", "36M", "36M", "7.2M", "1.8M", 56, 6, "1d 19h 12m", 624855, "FC9"],
            ["FC8-3", "36M", "36M", "7.2M", "1.8M", 56, 6, "1d 19h 12m", 634995, "FC9"],
            ["FC8-4", "36M", "36M", "7.2M", "1.8M", 56, 6, "1d 19h 12m", 645135, "FC9"],
            ["FC9-0", "36M", "36M", "7.2M", "1.8M", 28, 12, "1d 19h 12m", 655275, "FC9"],
            ["FC9-1", "42M", "42M", "8.4M", "2.1M", 70, 14, "2d 19h 12m", 665415, "FC10"],
            ["FC9-2", "42M", "42M", "8.4M", "2.1M", 70, 14, "2d 19h 12m", 675555, "FC10"],
            ["FC9-3", "42M", "42M", "8.4M", "2.1M", 70, 14, "2d 19h 12m", 685695, "FC10"],
            ["FC9-4", "42M", "42M", "8.4M", "2.1M", 70, 14, "2d 19h 12m", 695835, "FC10"],
            ["FC10-0", "42M", "42M", "8.4M", "2.1M", 35, 28, "2d 19h 12m", 705975, "FC10"],
        ]
    },
    "infantry_camp": {
        "levels": [
            ["30-1", "23M", "23M", "4.7M", "1.1M", 59, 0, "1d 1h 12m", 316180, "FC1"],
            ["30-2", "23M", "23M", "4.7M", "1.1M", 59, 0, "1d 1h 12m", 327660, "FC1"],
            ["30-3", "23M", "23M", "4.7M", "1.1M", 59, 0, "1d 1h 12m", 339140, "FC1"],
            ["30-4", "23M", "23M", "4.7M", "1.1M", 59, 0, "1d 1h 12m", 350620, "FC1"],
            ["FC1-0", "23M", "23M", "4.7M", "1.1M", 59, 0, "1d 1h 12m", 362100, "FC1"],
            ["FC1-1", "25M", "25M", "5M", "1.2M", 71, 0, "1d 8h 24m", 373580, "FC2"],
            ["FC1-2", "25M", "25M", "5M", "1.2M", 71, 0, "1d 8h 24m", 385060, "FC2"],
            ["FC1-3", "25M", "25M", "5M", "1.2M", 71, 0, "1d 8h 24m", 396540, "FC2"],
            ["FC1-4", "25M", "25M", "5M", "1.2M", 71, 0, "1d 8h 24m", 408020, "FC2"],
            ["FC2-0", "25M", "25M", "5M", "1.2M", 71, 0, "1d 8h 24m", 419500, "FC2"],
            ["FC2-1", "27M", "27M", "5.5M", "1.3M", 107, 0, "1d 15h 36m", 430980, "FC3"],
            ["FC2-2", "27M", "27M", "5.5M", "1.3M", 107, 0, "1d 15h 36m", 442460, "FC3"],
            ["FC2-3", "27M", "27M", "5.5M", "1.3M", 107, 0, "1d 15h 36m", 453940, "FC3"],
            ["FC2-4", "27M", "27M", "5.5M", "1.3M", 107, 0, "1d 15h 36m", 465420, "FC3"],
            ["FC3-0", "27M", "27M", "5.5M", "1.3M", 107, 0, "1d 15h 36m", 476900, "FC3"],
            ["FC3-1", "28M", "28M", "5.7M", "1.4M", 126, 0, "1d 19h 12m", 489540, "FC4"],
            ["FC3-2", "28M", "28M", "5.7M", "1.4M", 126, 0, "1d 19h 12m", 502180, "FC4"],
            ["FC3-3", "28M", "28M", "5.7M", "1.4M", 126, 0, "1d 19h 12m", 514820, "FC4"],
            ["FC3-4", "28M", "28M", "5.7M", "1.4M", 126, 0, "1d 19h 12m", 527460, "FC4"],
            ["FC4-0", "28M", "28M", "5.7M", "1.4M", 126, 0, "1d 19h 12m", 540100, "FC4"],
            ["FC4-1", "29M", "29M", "5.9M", "1.4M", 150, 0, "2d 2h 24m", 552740, "FC5"],
            ["FC4-2", "29M", "29M", "5.9M", "1.4M", 150, 0, "2d 2h 24m", 565380, "FC5"],
            ["FC4-3", "29M", "29M", "5.9M", "1.4M", 150, 0, "2d 2h 24m", 578020, "FC5"],
            ["FC4-4", "29M", "29M", "5.9M", "1.4M", 150, 0, "2d 2h 24m", 590660, "FC5"],
            ["FC5-0", "29M", "29M", "5.9M", "1.4M", 150, 0, "2d 2h 24m", 603300, "FC5"],
            ["FC5-1", "33M", "33M", "6.7M", "1.6M", 90, 4, "2d 6h", 616820, "FC6"],
            ["FC5-2", "33M", "33M", "6.7M", "1.6M", 90, 4, "2d 6h", 630340, "FC6"],
            ["FC5-3", "33M", "33M", "6.7M", "1.6M", 90, 4, "2d 6h", 643860, "FC6"],
            ["FC5-4", "33M", "33M", "6.7M", "1.6M", 90, 4, "2d 6h", 657380, "FC6"],
            ["FC6-0", "33M", "33M", "6.7M", "1.6M", 45, 9, "2d 6h", 670900, "FC6"],
            ["FC6-1", "38M", "38M", "7.6M", "1.9M", 108, 6, "2d 16h 48m", 684420, "FC7"],
            ["FC6-2", "38M", "38M", "7.6M", "1.9M", 108, 6, "2d 16h 48m", 697940, "FC7"],
            ["FC6-3", "38M", "38M", "7.6M", "1.9M", 108, 6, "2d 16h 48m", 711460, "FC7"],
            ["FC6-4", "38M", "38M", "7.6M", "1.9M", 108, 6, "2d 16h 48m", 724980, "FC7"],
            ["FC7-0", "38M", "38M", "7.6M", "1.9M", 54, 13, "2d 16h 48m", 738500, "FC7"],
            ["FC7-1", "46M", "46M", "9.3M", "2.3M", 108, 9, "3d", 752020, "FC8"],
            ["FC7-2", "46M", "46M", "9.3M", "2.3M", 108, 9, "3d", 765540, "FC8"],
            ["FC7-3", "46M", "46M", "9.3M", "2.3M", 108, 9, "3d", 779060, "FC8"],
            ["FC7-4", "46M", "46M", "9.3M", "2.3M", 108, 9, "3d", 792580, "FC8"],
            ["FC8-0", "46M", "46M", "9.3M", "2.3M", 54, 19, "3d", 806100, "FC8"],
            ["FC8-1", "50M", "50M", "10M", "2.5M", 126, 13, "2d", 819620, "FC9"],
            ["FC8-2", "50M", "50M", "10M", "2.5M", 126, 13, "2d", 833140, "FC9"],
            ["FC8-3", "50M", "50M", "10M", "2.5M", 126, 13, "2d", 846660, "FC9"],
            ["FC8-4", "50M", "50M", "10M", "2.5M", 126, 13, "2d", 860180, "FC9"],
            ["FC9-0", "50M", "50M", "10M", "2.5M", 63, 27, "2d", 873700, "FC9"],
            ["FC9-1", "58M", "58M", "11.6M", "2.9M", 157, 31, "3d", 887220, "FC10"],
            ["FC9-2", "58M", "58M", "11.6M", "2.9M", 157, 31, "3d", 900740, "FC10"],
            ["FC9-3", "58M", "58M", "11.6M", "2.9M", 157, 31, "3d", 914260, "FC10"],
            ["FC9-4", "58M", "58M", "11.6M", "2.9M", 157, 31, "3d", 927780, "FC10"],
            ["FC10-0", "58M", "58M", "11.6M", "2.9M", 78, 63, "3d", 941300, "FC10"],
        ]
    },
    "lancer_camp": {
        "levels": [
            ["30-1", "23M", "23M", "4.7M", "1.1M", 59, 0, "1d 1h 12m", 316180, "FC1"],
            ["30-2", "23M", "23M", "4.7M", "1.1M", 59, 0, "1d 1h 12m", 327660, "FC1"],
            ["30-3", "23M", "23M", "4.7M", "1.1M", 59, 0, "1d 1h 12m", 339140, "FC1"],
            ["30-4", "23M", "23M", "4.7M", "1.1M", 59, 0, "1d 1h 12m", 350620, "FC1"],
            ["FC1-0", "23M", "23M", "4.7M", "1.1M", 59, 0, "1d 1h 12m", 362100, "FC1"],
            ["FC1-1", "25M", "25M", "5M", "1.2M", 71, 0, "1d 8h 24m", 373580, "FC2"],
            ["FC1-2", "25M", "25M", "5M", "1.2M", 71, 0, "1d 8h 24m", 385060, "FC2"],
            ["FC1-3", "25M", "25M", "5M", "1.2M", 71, 0, "1d 8h 24m", 396540, "FC2"],
            ["FC1-4", "25M", "25M", "5M", "1.2M", 71, 0, "1d 8h 24m", 408020, "FC2"],
            ["FC2-0", "25M", "25M", "5M", "1.2M", 71, 0, "1d 8h 24m", 419500, "FC2"],
            ["FC2-1", "27M", "27M", "5.5M", "1.3M", 107, 0, "1d 15h 36m", 430980, "FC3"],
            ["FC2-2", "27M", "27M", "5.5M", "1.3M", 107, 0, "1d 15h 36m", 442460, "FC3"],
            ["FC2-3", "27M", "27M", "5.5M", "1.3M", 107, 0, "1d 15h 36m", 453940, "FC3"],
            ["FC2-4", "27M", "27M", "5.5M", "1.3M", 107, 0, "1d 15h 36m", 465420, "FC3"],
            ["FC3-0", "27M", "27M", "5.5M", "1.3M", 107, 0, "1d 15h 36m", 476900, "FC3"],
            ["FC3-1", "28M", "28M", "5.7M", "1.4M", 126, 0, "1d 19h 12m", 489540, "FC4"],
            ["FC3-2", "28M", "28M", "5.7M", "1.4M", 126, 0, "1d 19h 12m", 502180, "FC4"],
            ["FC3-3", "28M", "28M", "5.7M", "1.4M", 126, 0, "1d 19h 12m", 514820, "FC4"],
            ["FC3-4", "28M", "28M", "5.7M", "1.4M", 126, 0, "1d 19h 12m", 527460, "FC4"],
            ["FC4-0", "28M", "28M", "5.7M", "1.4M", 126, 0, "1d 19h 12m", 540100, "FC4"],
            ["FC4-1", "29M", "29M", "5.9M", "1.4M", 150, 0, "2d 2h 24m", 552740, "FC5"],
            ["FC4-2", "29M", "29M", "5.9M", "1.4M", 150, 0, "2d 2h 24m", 565380, "FC5"],
            ["FC4-3", "29M", "29M", "5.9M", "1.4M", 150, 0, "2d 2h 24m", 578020, "FC5"],
            ["FC4-4", "29M", "29M", "5.9M", "1.4M", 150, 0, "2d 2h 24m", 590660, "FC5"],
            ["FC5-0", "29M", "29M", "5.9M", "1.4M", 150, 0, "2d 2h 24m", 603300, "FC5"],
            ["FC5-1", "33M", "33M", "6.7M", "1.6M", 90, 4, "2d 6h", 616820, "FC6"],
            ["FC5-2", "33M", "33M", "6.7M", "1.6M", 90, 4, "2d 6h", 630340, "FC6"],
            ["FC5-3", "33M", "33M", "6.7M", "1.6M", 90, 4, "2d 6h", 643860, "FC6"],
            ["FC5-4", "33M", "33M", "6.7M", "1.6M", 90, 4, "2d 6h", 657380, "FC6"],
            ["FC6-0", "33M", "33M", "6.7M", "1.6M", 45, 9, "2d 6h", 670900, "FC6"],
            ["FC6-1", "38M", "38M", "7.6M", "1.9M", 108, 6, "2d 16h 48m", 684420, "FC7"],
            ["FC6-2", "38M", "38M", "7.6M", "1.9M", 108, 6, "2d 16h 48m", 697940, "FC7"],
            ["FC6-3", "38M", "38M", "7.6M", "1.9M", 108, 6, "2d 16h 48m", 711460, "FC7"],
            ["FC6-4", "38M", "38M", "7.6M", "1.9M", 108, 6, "2d 16h 48m", 724980, "FC7"],
            ["FC7-0", "38M", "38M", "7.6M", "1.9M", 54, 13, "2d 16h 48m", 738500, "FC7"],
            ["FC7-1", "46M", "46M", "9.3M", "2.3M", 108, 9, "3d", 752020, "FC8"],
            ["FC7-2", "46M", "46M", "9.3M", "2.3M", 108, 9, "3d", 765540, "FC8"],
            ["FC7-3", "46M", "46M", "9.3M", "2.3M", 108, 9, "3d", 779060, "FC8"],
            ["FC7-4", "46M", "46M", "9.3M", "2.3M", 108, 9, "3d", 792580, "FC8"],
            ["FC8-0", "46M", "46M", "9.3M", "2.3M", 54, 19, "3d", 806100, "FC8"],
            ["FC8-1", "50M", "50M", "10M", "2.5M", 126, 13, "2d", 819620, "FC9"],
            ["FC8-2", "50M", "50M", "10M", "2.5M", 126, 13, "2d", 833140, "FC9"],
            ["FC8-3", "50M", "50M", "10M", "2.5M", 126, 13, "2d", 846660, "FC9"],
            ["FC8-4", "50M", "50M", "10M", "2.5M", 126, 13, "2d", 860180, "FC9"],
            ["FC9-0", "50M", "50M", "10M", "2.5M", 63, 27, "2d", 873700, "FC9"],
            ["FC9-1", "58M", "58M", "11.6M", "2.9M", 157, 31, "3d", 887220, "FC10"],
            ["FC9-2", "58M", "58M", "11.6M", "2.9M", 157, 31, "3d", 900740, "FC10"],
            ["FC9-3", "58M", "58M", "11.6M", "2.9M", 157, 31, "3d", 914260, "FC10"],
            ["FC9-4", "58M", "58M", "11.6M", "2.9M", 157, 31, "3d", 927780, "FC10"],
            ["FC10-0", "58M", "58M", "11.6M", "2.9M", 78, 63, "3d", 941300, "FC10"],
        ]
    },
    "marksman_camp": {
        "levels": [
            ["30-1", "23M", "23M", "4.7M", "1.1M", 59, 0, "1d 1h 12m", 316180, "FC1"],
            ["30-2", "23M", "23M", "4.7M", "1.1M", 59, 0, "1d 1h 12m", 327660, "FC1"],
            ["30-3", "23M", "23M", "4.7M", "1.1M", 59, 0, "1d 1h 12m", 339140, "FC1"],
            ["30-4", "23M", "23M", "4.7M", "1.1M", 59, 0, "1d 1h 12m", 350620, "FC1"],
            ["FC1-0", "23M", "23M", "4.7M", "1.1M", 59, 0, "1d 1h 12m", 362100, "FC1"],
            ["FC1-1", "25M", "25M", "5M", "1.2M", 71, 0, "1d 8h 24m", 373580, "FC2"],
            ["FC1-2", "25M", "25M", "5M", "1.2M", 71, 0, "1d 8h 24m", 385060, "FC2"],
            ["FC1-3", "25M", "25M", "5M", "1.2M", 71, 0, "1d 8h 24m", 396540, "FC2"],
            ["FC1-4", "25M", "25M", "5M", "1.2M", 71, 0, "1d 8h 24m", 408020, "FC2"],
            ["FC2-0", "25M", "25M", "5M", "1.2M", 71, 0, "1d 8h 24m", 419500, "FC2"],
            ["FC2-1", "27M", "27M", "5.5M", "1.3M", 107, 0, "1d 15h 36m", 430980, "FC3"],
            ["FC2-2", "27M", "27M", "5.5M", "1.3M", 107, 0, "1d 15h 36m", 442460, "FC3"],
            ["FC2-3", "27M", "27M", "5.5M", "1.3M", 107, 0, "1d 15h 36m", 453940, "FC3"],
            ["FC2-4", "27M", "27M", "5.5M", "1.3M", 107, 0, "1d 15h 36m", 465420, "FC3"],
            ["FC3-0", "27M", "27M", "5.5M", "1.3M", 107, 0, "1d 15h 36m", 476900, "FC3"],
            ["FC3-1", "28M", "28M", "5.7M", "1.4M", 126, 0, "1d 19h 12m", 489540, "FC4"],
            ["FC3-2", "28M", "28M", "5.7M", "1.4M", 126, 0, "1d 19h 12m", 502180, "FC4"],
            ["FC3-3", "28M", "28M", "5.7M", "1.4M", 126, 0, "1d 19h 12m", 514820, "FC4"],
            ["FC3-4", "28M", "28M", "5.7M", "1.4M", 126, 0, "1d 19h 12m", 527460, "FC4"],
            ["FC4-0", "28M", "28M", "5.7M", "1.4M", 126, 0, "1d 19h 12m", 540100, "FC4"],
            ["FC4-1", "29M", "29M", "5.9M", "1.4M", 150, 0, "2d 2h 24m", 552740, "FC5"],
            ["FC4-2", "29M", "29M", "5.9M", "1.4M", 150, 0, "2d 2h 24m", 565380, "FC5"],
            ["FC4-3", "29M", "29M", "5.9M", "1.4M", 150, 0, "2d 2h 24m", 578020, "FC5"],
            ["FC4-4", "29M", "29M", "5.9M", "1.4M", 150, 0, "2d 2h 24m", 590660, "FC5"],
            ["FC5-0", "29M", "29M", "5.9M", "1.4M", 150, 0, "2d 2h 24m", 603300, "FC5"],
            ["FC5-1", "33M", "33M", "6.7M", "1.6M", 90, 4, "2d 6h", 616820, "FC6"],
            ["FC5-2", "33M", "33M", "6.7M", "1.6M", 90, 4, "2d 6h", 630340, "FC6"],
            ["FC5-3", "33M", "33M", "6.7M", "1.6M", 90, 4, "2d 6h", 643860, "FC6"],
            ["FC5-4", "33M", "33M", "6.7M", "1.6M", 90, 4, "2d 6h", 657380, "FC6"],
            ["FC6-0", "33M", "33M", "6.7M", "1.6M", 45, 9, "2d 6h", 670900, "FC6"],
            ["FC6-1", "38M", "38M", "7.6M", "1.9M", 108, 6, "2d 16h 48m", 684420, "FC7"],
            ["FC6-2", "38M", "38M", "7.6M", "1.9M", 108, 6, "2d 16h 48m", 697940, "FC7"],
            ["FC6-3", "38M", "38M", "7.6M", "1.9M", 108, 6, "2d 16h 48m", 711460, "FC7"],
            ["FC6-4", "38M", "38M", "7.6M", "1.9M", 108, 6, "2d 16h 48m", 724980, "FC7"],
            ["FC7-0", "38M", "38M", "7.6M", "1.9M", 54, 13, "2d 16h 48m", 738500, "FC7"],
            ["FC7-1", "46M", "46M", "9.3M", "2.3M", 108, 9, "3d", 752020, "FC8"],
            ["FC7-2", "46M", "46M", "9.3M", "2.3M", 108, 9, "3d", 765540, "FC8"],
            ["FC7-3", "46M", "46M", "9.3M", "2.3M", 108, 9, "3d", 779060, "FC8"],
            ["FC7-4", "46M", "46M", "9.3M", "2.3M", 108, 9, "3d", 792580, "FC8"],
            ["FC8-0", "46M", "46M", "9.3M", "2.3M", 54, 19, "3d", 806100, "FC8"],
            ["FC8-1", "50M", "50M", "10M", "2.5M", 126, 13, "2d", 819620, "FC9"],
            ["FC8-2", "50M", "50M", "10M", "2.5M", 126, 13, "2d", 833140, "FC9"],
            ["FC8-3", "50M", "50M", "10M", "2.5M", 126, 13, "2d", 846660, "FC9"],
            ["FC8-4", "50M", "50M", "10M", "2.5M", 126, 13, "2d", 860180, "FC9"],
            ["FC9-0", "50M", "50M", "10M", "2.5M", 63, 27, "2d", 873700, "FC9"],
            ["FC9-1", "58M", "58M", "11.6M", "2.9M", 157, 31, "3d", 887220, "FC10"],
            ["FC9-2", "58M", "58M", "11.6M", "2.9M", 157, 31, "3d", 900740, "FC10"],
            ["FC9-3", "58M", "58M", "11.6M", "2.9M", 157, 31, "3d", 914260, "FC10"],
            ["FC9-4", "58M", "58M", "11.6M", "2.9M", 157, 31, "3d", 927780, "FC10"],
            ["FC10-0", "58M", "58M", "11.6M", "2.9M", 78, 63, "3d", 941300, "FC10"],
        ]
    },
}


def build_edges() -> tuple[list, list]:
    """Build FC edges from raw data."""
    edges = []
    issues = []

    for building_id, data in FC_BUILDINGS_DATA.items():
        levels = data["levels"]

        for i in range(len(levels) - 1):
            current = levels[i]
            next_lvl = levels[i + 1]

            lvl_from = current[0]
            lvl_to = next_lvl[0]

            # Parse costs
            wood = parse_cost(current[1])
            meat = parse_cost(current[2])
            coal = parse_cost(current[3])
            iron = parse_cost(current[4])
            fire_crystal = current[5]
            refined_fc = current[6]
            time_str = current[7]
            furnace_prereq = current[9]

            time_seconds = parse_time(time_str)

            # Build prerequisite
            prereq = []
            if furnace_prereq and building_id != "furnace":
                prereq.append({
                    "system": "buildings",
                    "building_id": "furnace",
                    "level": furnace_prereq
                })

            edge = {
                "upgrade_id": f"building_fc:{building_id}:{lvl_from}->{lvl_to}",
                "from": {"building_id": building_id, "level": lvl_from},
                "to": {"building_id": building_id, "level": lvl_to},
                "cost": {
                    "wood": wood,
                    "meat": meat,
                    "coal": coal,
                    "iron": iron,
                    "fire_crystal": fire_crystal,
                    "refined_fire_crystal": refined_fc,
                    "speedups_seconds": 0
                },
                "time_seconds": time_seconds,
                "prereq": prereq,
                "benefit": None,
                "source_ids": ["SRC_BUILDING_CALCULATOR"],
                "evidence": {"sample_key": f"{building_id}_{lvl_from}_to_{lvl_to}"},
                "confidence": {"grade": "B", "reason": "calculator output capture"}
            }
            edges.append(edge)

    return edges, issues


def validate_edges(edges: list) -> dict:
    """Run edge integrity validation."""
    issues = []

    # Check for duplicates
    edge_ids = set()
    for edge in edges:
        if edge["upgrade_id"] in edge_ids:
            issues.append(f"Duplicate edge: {edge['upgrade_id']}")
        edge_ids.add(edge["upgrade_id"])

    # Check all costs are non-negative
    for edge in edges:
        for resource, amount in edge["cost"].items():
            if amount < 0:
                issues.append(f"Negative cost {resource}={amount} in {edge['upgrade_id']}")

    return {
        "ok": len(issues) == 0,
        "issues": issues
    }


def main():
    print("Building FC edges...")
    edges, build_issues = build_edges()

    print("Validating edges...")
    validation = validate_edges(edges)

    all_issues = build_issues + validation["issues"]

    timestamp = datetime.now(timezone.utc).isoformat().replace("+00:00", "Z")

    edges_output = {
        "system": "buildings_fc",
        "unit": "level",
        "currencies": ["wood", "meat", "coal", "iron", "fire_crystal", "refined_fire_crystal", "speedups_seconds"],
        "generated_at": timestamp,
        "notes": [
            "FC (Fire Crystal) levels for buildings beyond L30",
            "Levels range from 30-1 through FC10-0",
            "Refined Fire Crystals appear at FC5+ levels"
        ],
        "edges": edges
    }

    # Count edges per building
    building_counts = {}
    for edge in edges:
        bid = edge["from"]["building_id"]
        building_counts[bid] = building_counts.get(bid, 0) + 1

    report = {
        "system": "buildings_fc",
        "generated_at": timestamp,
        "ok": len(all_issues) == 0,
        "total_edges": len(edges),
        "buildings_covered": list(building_counts.keys()),
        "edges_per_building": building_counts,
        "level_range": "30-1 to FC10-0",
        "issues": all_issues,
        "notes": []
    }

    # Save files
    print(f"Saving edges to {EDGES_FILE}...")
    EDGES_FILE.parent.mkdir(parents=True, exist_ok=True)
    with open(EDGES_FILE, 'w', encoding='utf-8') as f:
        json.dump(edges_output, f, indent=2)

    print(f"Saving report to {REPORT_FILE}...")
    with open(REPORT_FILE, 'w', encoding='utf-8') as f:
        json.dump(report, f, indent=2)

    # Print summary
    print("\n" + "="*60)
    print("BUILDINGS FC BUILD COMPLETE")
    print("="*60)
    print(f"Total edges: {report['total_edges']}")
    print(f"Buildings covered: {len(building_counts)}")
    for bid, count in building_counts.items():
        print(f"  - {bid}: {count} edges")
    print(f"Status: {'OK' if report['ok'] else 'FAILED'}")

    if all_issues:
        print(f"Issues: {len(all_issues)}")

    print("="*60)

    return report["ok"]


if __name__ == "__main__":
    success = main()
    exit(0 if success else 1)
